
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4. 配備構成 &mdash; The enStratus Documentation Project</title>
    
    <link rel="stylesheet" href="../_static/adctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="The enStratus Documentation Project" href="../index.html" />
    <link rel="next" title="5. Deployment Operation" href="../deployment_operation/deployment_operation.html" />
    <link rel="prev" title="3. サービス" href="../services/services.html" />
    <link media="only screen and (max-device-width: 480px)" href="../_static/mobile.css" type="text/css" rel="stylesheet" /> 
  </head>
  <body>
<div id="docstitle">
	<p>The enStratus Documentation Project</p>
</div>
<div id="header">
	<div id="title"><h1>4. 配備構成</h1></div>
	<ul id="headerButtons">
		<li id="toc_button"><div class="headerButton"><a href="#">Table of Contents</a></div></li>
		<li id="page_buttons">
			<div class="headerButton"><a href="../genindex.html" title="General Index" accesskey="I">index</a></div>
			<div class="headerButton"><a href="../deployment_operation/deployment_operation.html" title="5. Deployment Operation" accesskey="N">next</a></div>
			<div class="headerButton"><a href="../services/services.html" title="3. サービス" accesskey="P">previous</a></div>
			<div class="headerButton"><a href="http://on-premise.enstratus.com">On-Premise</a></div>
			<div class="headerButton"><a href="http://docs.enstratus.com">SaaS</a></div>
			<div class="headerButton"><a href="http://automation.enstratus.com">Advanced Automation</a></div>
			<div class="headerButton"><a href="http://agent.enstratus.com">enStratus Agent</a></div>
		</li>
	</ul>
</div>

<div id="sphinxsidebar">
  <div class="sphinxsidebarwrapper">
	<ul><li class="toctree-l1"><a href="../index.html">Main Page</a></li></ul>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">1. はじめに</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/overview.html">2. 概要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/services.html">3. サービス</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">4. 配備構成</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id4">4.1. ユーザー　インタフェース</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">4.2. 配備管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">4.3. ロード·バランサ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">4.4. マシンイメージ/テンプレート</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id14">4.5. サービス</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">4.6. データ·ソース</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id16">4.7. ボリューム</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id17">4.8. 起動構成</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id21">4.9. 層</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ssl">4.10. SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#backups">4.11. Backups</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deployment_operation/deployment_operation.html">5. Deployment Operation</a></li>
</ul>

    <h3>Downloads</h3>
    <ul><li><a href="http://es-content.s3.amazonaws.com/enstratus-api-latest.pdf">API Specification</a></li>
    <li><a href="http://es-content.s3.amazonaws.com/Security_Architecture.pdf">Security Architecture</a></li>
    </ul>
      <h3>This Page</h3>
      <ul class="this-page-menu">
        <li><a href="../_sources/deployment_configuration/deployment_configuration.txt"
               rel="nofollow">Show Source</a></li>
      </ul>
    <div id="searchbox" style="display: none">
      
        <form class="search" action="../search.html" method="get">
			<div class="search-wrapper">
			<span class="search-left"></span>
			<input class="prettysearch" type="text" name="q" size="18" />
			<span class="search-right">&nbsp;</span>
			</div>
          <input type="submit" value="Search" class="searchbutton" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
        <p class="searchtip" style="font-size: 90%">
        Enter search terms or a module, class or function name.
        </p>
    </div>
    <script type="text/javascript">$('#searchbox').show(0);</script>
  </div>
</div>



    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>4. 配備構成<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">スクリーンショットの一部はここに示すものと異なる場合があります。
すべてのケースの違いは、修飾的なもので操作に影響を及ぼしません。</p>
</div>
<p>このセクションの目的は、enStratusの配備構成オプションの中を歩きまわることです。</p>
<p><a href="#id2"><span class="problematic" id="id3">`</span></a>Overview &lt;../introduction/overview.html&gt;`セクションでは、我々は、enStratus配備の作成に関与した
概念を説明しました。
。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>配備構成にアプローチする前に、次のコンポーネンを手に入れる必要があります。：</p>
<ol class="last arabic simple">
<li>作業するマシンイメージ/テンプレートが有って、enStratusエージェントがインストールされてテストされていること。</li>
<li>インストールすべき各アプリケーション/データベースのサービスイメージ。</li>
</ol>
</div>
<p>enStratusはアプリケーション/データベースが実行される環境について知っていて、
その環境についての情報をサービスに通知します。</p>
<p>enStratusは完全に自動化された環境を配備、管理するすべてのツールを提供します。</p>
<div class="section" id="id4">
<h2>4.1. ユーザー　インタフェース<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>enStratus自動化インターフェイスは、直感的で操作しやすいように設計されています。enStratusコンソールには
対話作業と構成の自動化に関連するいくつかのセクションがあります。</p>
<p>配備デザイナのインターフェイスでは、enStratusのWebコンソールを使用してユーザーがアプリケーションの
アーキテクチャを構築します。</p>
<div class="section" id="diagram">
<h3>4.1.1. Diagram<a class="headerlink" href="#diagram" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/deploymentDiagram.png"><img alt="Deployment Designer" src="../_images/deploymentDiagram.png" style="width: 490.0px; height: 371.0px;" /></a>
<p class="caption">Deployment Designer (Diagram View)</p>
</div>
</div>
<div class="section" id="table">
<h3>4.1.2. Table<a class="headerlink" href="#table" title="Permalink to this headline">¶</a></h3>
<p>この配備では、1つのリージョンで2階層の層と2つの起動構成を持っています。
配備のグラフィカルな表現は、テーブルビューに切り替えることができます。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/deploymentTable.png"><img alt="Deployment Designer (Table View)" src="../_images/deploymentTable.png" style="width: 450.0px; height: 225.0px;" /></a>
<p class="caption">Deployment Designer (Table View)</p>
</div>
</div>
<div class="section" id="id5">
<h3>4.1.3. 配備ダッシュボード<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>配備ダッシュボードは、関連する統計情報やその他の情報を配備管理者に表示します。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/deploymentDashboard.png"><img alt="Deployment Dashboard" src="../_images/deploymentDashboard.png" style="width: 650.0px; height: 350.0px;" /></a>
<p class="caption">Deployment Dashboard</p>
</div>
</div>
</div>
<div class="section" id="id6">
<h2>4.2. 配備管理<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/deploymentManagement.png"><img alt="Deployment Management" src="../_images/deploymentManagement.png" style="width: 780.0px; height: 300.0px;" /></a>
<p class="caption">Deployment Management</p>
</div>
<p>配備の管理と構成が開始すると上記の図で示すオプションが表示されます。</p>
<ol class="arabic">
<li><p class="first"><strong>Name</strong></p>
<p>配備の名前は、enStratusコンソールに単に提示される論理名です。</p>
</li>
<li><p class="first"><strong>Label</strong></p>
<p>任意のカラーコードを配備に適用可能。</p>
</li>
<li><p class="first"><strong>Deployment Type</strong></p>
<p>配備タイプには、2つのオプションがあります。</p>
<ul>
<li><p>専用</p>
<p>専用の配備は、同じ課金コードに対してすべての配備コストを追跡します。</p>
</li>
<li><p>共用</p>
<p>共有の配備は、複数の課金コードに対して、配備コストを追跡します。
共有配備を選択した場合、課金コードの使用は、サービスレベルで追跡されます。</p>
</li>
</ul>
</li>
<li><p class="first"><strong>Disaster Recovery Storage</strong></p>
<p>ディザスタ　リカバリ　ストレージは、バックアップファイルにクラウド　ストレージ　オプションを指定します。
災害復旧目的で、/enstratus/bin/backupService を経由して1つのクラウド内のすべてまたは配備の一部を
他のクラウドに一括してバックアップ実行することが可能です。</p>
</li>
<li><p class="first"><strong>Billing Code</strong></p>
<p>課金コードは、すべての配備料が行われる対象となるコードです。</p>
</li>
<li><p class="first"><strong>Owner</strong></p>
<p>所有者は、ロールベースのアクセスコントロールが、配備に適用される場合があるので、
その配備のためのオプションの所有者を指定します。</p>
</li>
<li><p class="first"><strong>Description</strong></p>
<p>説明(&#8220;description&#8221;)は、配備を記述するための自由形式のテキストフィールドです。</p>
</li>
</ol>
<div class="section" id="id7">
<h3>4.2.1. バックアップ/メンテナンス<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/backupMaintenance.png"><img alt="Backup and Maintenance" src="../_images/backupMaintenance.png" style="width: 750.0px; height: 300.0px;" /></a>
<p class="caption">Backup and Maintenance</p>
</div>
<p>バックアップオプションでは、enStratusが何時バックアップを実行するかを設定します。
(接続されたボリュームのスナップショットまたは/enstratus/bin/backupServiceのエージェントスクリプトを介したサービスレベルのバックアップのような)</p>
</div>
<div class="section" id="id8">
<h3>4.2.2. サーバ/サービスの管理<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>これらのタブは配備で実行されている全てのサーバーの集約されたビューと配備にインストールされている全てのサービスを表示します。</p>
</div>
</div>
<div class="section" id="id9">
<h2>4.3. ロード·バランサ<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>ロードバランサは通常、複数のアプリケーション·サーバーにトラフィックを分散させます。 enStratusは
異なるメカニズムを介して複数のタイプのロードバランサをサポートしています。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/loadBalancer.png"><img alt="Load Balancer" src="../_images/loadBalancer.png" style="width: 200.0px; height: 200.0px;" /></a>
<p class="caption">Load Balancer</p>
</div>
<div class="section" id="id10">
<h3>4.3.1. 物理的な<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>仮想マシンベースのロードバランサはロードバランサとして HA-Proxy、 mod-jk、 zeus を使用することができます。
サービスが、仮想マシンベースのロードバランサに接続されている場合、エージェントスクリプト /enstratus/bin/startProxy が使用され、
新しいアプリケーションサーバーがプールに参加したことをロードバランサに通知します。エージェントスクリプト /enstratus/bin/stopProxy が使用され、
アプリケーションサーバーがプールから去ったことを、ロード·バランサに通知します。</p>
</div>
<div class="section" id="elb">
<h3>4.3.2. 仮想（例：ELB）<a class="headerlink" href="#elb" title="Permalink to this headline">¶</a></h3>
<p>いくつかのクラウド　プロバイダーは仮想ロードバランサの形でサービス　ベースのロードバランシング
をサポートします。 AWSでは、これは弾性ロードバランサ（ELB）と呼ばれています。 cloudstackで（cloud.com）
クラウドでは、時にはこれをルータ仮想マシン（RVM）と呼びます。もしクラウド　プロバイダーが
この概念をAPIとしてサポートしているならば、enStratusはそれをサポートすることができます。</p>
<p>サービスが仮想ロードバランサに接続されていて、そのサービスが実行されている時にサーバーが
ロードバランサに追加されたりそこから削除される際にAPIの呼び出しを介して行われます。さらに、もし
ロードバランサは、特定のゾーンまたはゾーンへのトラフィックのバランスを取るために設定されているならば、
enStratusはアプリケーション·サーバーがこれらのゾーンでのみ開始されることを保証します。</p>
<p>ロードバランシングは、enStratusで <em>service</em> レベルでの配備に接続されています。
重要なポイントを手短に説明します。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">配備で複数のロードバランサを関連付けることができます。この機能は
クラウドをまたがるときや大規模なスケール、地理的に分散して作業するときに便利です。</p>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/addLoadBalancer.png"><img alt="Adding a Load Balancer" src="../_images/addLoadBalancer.png" style="width: 550.0px; height: 300.0px;" /></a>
<p class="caption">Adding a Load Balancer</p>
</div>
<p>ロードバランサのコンフィグレーションオプションは次のとおりです。</p>
<ol class="arabic">
<li><p class="first"><strong>Account</strong></p>
<p>アカウントには、ロードバランサがプロビジョニングされているアカウントを指定します。もし
管理者が複数のアカウントのメンバーであれば、ここで複数のオプションがあるかもしれません。
ロード·バランサが複数のクラウドにまたがっている可能性があります。たとえば、ロードバランサを、
EC2とcloud.comの両方で cloud.com cloud アプリケーションサーバーにプロビジョニングすることができます。</p>
</li>
<li><p class="first"><strong>Region</strong></p>
<p>クラウド内のリージョンにまたがってロード·バランサを持つことが可能です。たとえば、EC2
クラウドはこれを書いている時点で5つのリージョンを持っています。</p>
</li>
<li><p class="first"><strong>Scope</strong></p>
<p>スコープパラメータには、3つの異なる設定があります。</p>
</li>
</ol>
<blockquote>
<div><ul>
<li><p class="first"><strong>Global</strong></p>
<p>グローバル設定は、ロードバランサを、リージョン間でバランスをとります。
しかしELBなどの仮想ロードバランシングオファリングには無意味です。</p>
</li>
<li><p class="first"><strong>Regional</strong></p>
<p>リージョンのロードバランサは、1つのリージョンでのトラフィックのバランスを取り、
そのリージョンの内のすべてのデータセンターで均等にします。</p>
</li>
<li><p class="first"><strong>Data Center</strong></p>
<p>データセンターの設定は、特定のデータセンターでバランスをとります。このタイプの
ロードバランシングは、起動する前にデータセンター（ゾーン）を指定することができる、ELBのような
仮想ロードバランシングオファリングでのみ意味をもちます。この設定は、
そのようなオプションが存在しないVMベースのロードバランシングでは無意味です。。</p>
</li>
</ul>
</div></blockquote>
<p>enStratus内では3つのタイプのプロビジョニング可能なロード·バランサがあります。</p>
<ol class="arabic">
<li><p class="first"><strong>Cloud</strong></p>
<p>クラウドのロード バランサは、Amazon EC2の Elastic Load Balancerのような仮想ロードバランサです。
クラウド　プロバイダーがそのような概念を持たない場合は、オプションがありません。</p>
<p>オプションが提示されるには、クラウド　ロード　バランサがすでにプロビジョニング
されている必要があります。</p>
</li>
<li><p class="first"><strong>VM Dynamic</strong></p>
<p>VMの動的ロード　バランサは、その配備時にスタートすることを意味します。
enStratusは、仮想サーバを適切なリソースを使用した、指定されたテンプレートからのプロビジョニングをし、
指定されたファイアウォールにそれを起動します。VMの動的ロード　バランサがプロビジョニングされたならば、
自動回復の恩恵も受けます。</p>
</li>
<li><p class="first"><strong>VM Static</strong></p>
<p>VMの静的ロード·バランサは、VM上の /enstratus/bin/startProxy スクリプトを適切な時期に呼び出すことにより、
既存の仮想マシンをロードバランサに&#8221;変換&#8221;します。</p>
<p>現在、VMの静的ロード バランサには、自動回復の恩恵はありません。自動回復が望まれる場合、
代わりにVMの動的ロードバランサを使用します。</p>
</li>
</ol>
</div>
</div>
<div class="section" id="id11">
<h2>4.4. マシンイメージ/テンプレート<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">&#8220;ゴールデン&#8221;または&#8221;マスター&#8221;イメージを作成するのが一般的です。ベストプラクティスは、
特別な構成管理のタスクに適しているツールを利用することです。 enStratus
は Chef そして/または Puppetの両方の力を活用するができます。 enStratusも
このコンセプトの良い入門書となる独自の構成管理エンジンを提供しています。</p>
</div>
<p>マシンのイメージは、サーバーが開始されるテンプレートです。このドキュメントでは、高度に
イメージファイルの作成と保守のプロセスを熟知のしていることを想定しています。マシン保守の
バージョン管理に関しての方法が関心対象です。自動化環境では、配備を構成する前にenStratusエージェント
が、テンプレートにインストールされている <em>必要</em> があります。</p>
<div class="section" id="id12">
<h3>4.4.1. バージョン管理<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>配備で操作をしている場合、enStratusは、起動構成で使用してるマシンイメージのバージョン管理を援助
することができます。コンセプトはenStratusの自動展開機能の一部にあります。</p>
<p>要するに、配備において動作しているサーバーにパッチを当てます。そのパッチは、起動構成において
同様にパッチを当てられたAMI定義に適合して維持できることを確認する必要があります。
スケールまたは回復イベントが発生した場合に、新しく作成されたサーバのバージョンに
正しいマシンイメージを使用できる必要がありますから。</p>
</div>
<div class="section" id="id13">
<h3>4.4.2. 依存関係<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>enStratusには本当の依存関係は非常に少ないです。Javaに依存しますので、エージェントのサポートに必要な、
最新のJDKがインストールされていることを確認してください。自動化された配備環境で操作している時には
以下のソフトウェアをインストールすることをお勧めします。:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="51%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">パッケージ</th>
<th class="head">目的</th>
<th class="head">注意事項</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>zip</td>
<td>Backups</td>
<td>Recommended</td>
</tr>
<tr class="row-odd"><td>openssl</td>
<td>Adding Users</td>
<td><strong>Required</strong></td>
</tr>
<tr class="row-even"><td>unzip</td>
<td>Service install, backups</td>
<td>Recommended</td>
</tr>
<tr class="row-odd"><td>build-essential</td>
<td>OSSEC installation and more</td>
<td>Optional</td>
</tr>
<tr class="row-even"><td>xfsprogs</td>
<td>XFS filesystem functionality</td>
<td>Optional</td>
</tr>
<tr class="row-odd"><td>libapache2-mod-jk</td>
<td>mod_jk load balancing</td>
<td>Optional</td>
</tr>
<tr class="row-even"><td>postfix</td>
<td>Sending mail notifications</td>
<td>Optional</td>
</tr>
<tr class="row-odd"><td>cryptsetup</td>
<td>Encryption (LUKS)</td>
<td>Recommended</td>
</tr>
<tr class="row-even"><td>haproxy</td>
<td>Load Balancing</td>
<td>Optional</td>
</tr>
<tr class="row-odd"><td>cronolog</td>
<td>Logging</td>
<td>Optional</td>
</tr>
<tr class="row-even"><td>sysstat</td>
<td>OS metrics</td>
<td><strong>Required</strong></td>
</tr>
<tr class="row-odd"><td>secure-delete</td>
<td>Securely delete files</td>
<td>Recommended</td>
</tr>
<tr class="row-even"><td>mysql-server</td>
<td>Running MySQL Databases</td>
<td>Optional</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id14">
<h2>4.5. サービス<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p>サービスは、通常、tarで圧縮、またはgzipされた、ファイルの形式でソフトウェアオブジェクトです。
配備を設定する前に、サービスをクラウド　ストレージにアップロードする必要があります。</p>
<p>サービス &#8220;イメージ&#8221; はzipファイルで、enStratusにアップロードしてから、自動化配備環境を選択されて
使用されます。サービスは、層にインストールされており、いくつかの構成オプションを持ち、そのうちの一つは
依存関係として知られているサービス間の論理的な接続を達成することができます。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/addServiceImage.png"><img alt="Add Service Image" src="../_images/addServiceImage.png" style="width: 300.0px; height: 150.0px;" /></a>
<p class="caption">Add Service Image</p>
</div>
<p>サービスイメージをアップロードするには、 Automation &gt; Service Images に移動して、ローカル　ファイル　システム
からサービスイメージを選択します。サービスイメージのアップロードが終了したら、層で
使用するためのオプションとして利用可能になります。</p>
</div>
<div class="section" id="id15">
<h2>4.6. データ·ソース<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>enStratusにデータソースをアップロードするには、 Automation &gt; Data Source に移動し、
データソースの追加を選択します。</p>
<p>データソースはデータベースのバックアップファイルにすることができます。たとえば、MySQLデータベースのデータ
ソースは .sql の拡張子を持つファイルによって表現されます。このファイルは、データソースが関連付けられている
サービスの開始および構成時にクラウドストレージからダウンロードされます。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/addDataSource.png"><img alt="Add Data Source" src="../_images/addDataSource.png" style="width: 300.0px; height: 150.0px;" /></a>
<p class="caption">Add Data Source</p>
</div>
<p>Using
使用要領
%%%%%</p>
<p>Data sources are used when configuring a service. More is said about this in the
section on Tiers, which hold services. A data source is a database backup file, typically
in the form of a &#8220;dump&#8221; file of the form database1.sql. Data sources, like
services, should be uploaded into cloud storage before configuring the deployment.
サービスを設定するときにデータソースが使用されています。以上がこの程度と言われてい
サービスを保持層、上のセクションを参照してください。データソースは、通常、データベースのバックアップファイルです。
フォームdatabase1.sqlの&#8221;ダンプ&#8221;ファイルの形態であってもよい。データ·ソースのような
サービスは、展開を構成する前に、クラウド·ストレージにアップロードする必要があります。</p>
</div>
<div class="section" id="id16">
<h2>4.7. ボリューム<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<p>ボリュームは配備の開始時に起動構成の一部として設定されているパラメータに従って
enStratusによって自動的にプロビジョニングされます。 enStratusは、それがクラウド　プロバイダに存在して、
スケーリングおよびリカバリイベントを実行するとき、ボリュームを使用します。</p>
<p>ボリュームは、Linuxサーバーでは /mnt/services 上、そしてindowsサーバーでは H:/services 上にある
層で実行中のサーバーにマウントされています。サービスは自動的に serviceID が割り当てられ、
それは /mnt/services もしくは H:/services の a1234 形式のディレクトリになります。サービスへのパスは
フォーム /mnt/services/a1234 で、ここで a1234 は、自動的に生成された識別子になります。</p>
</div>
<div class="section" id="id17">
<h2>4.8. 起動構成<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<p>起動構成は仮想マシンをサポートするためにプロビジョニングされたリソースを管理する定義です。
1つのレベルでは、おおまかに言って、アマゾン AWS の small, medium, large, その他のような
クラウドによるサイズの定義とほぼ類似しています。
enStratusにとって、起動構成には、この定義が含まれていますが、それを超えてサーがーがその中でスタートする
ファイアウォールは勿論、ボリュームへの接続、レイディング、ボリュームの暗号化を含みます。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/launchConfigurationHighlighted.png"><img alt="Launch Configuration" src="../_images/launchConfigurationHighlighted.png" style="width: 250.0px; height: 300.0px;" /></a>
<p class="caption">起動構成</p>
</div>
<p>Manage Launch Configuration, General Information
起動構成の管理、一般情報
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</p>
<blockquote>
<div></div></blockquote>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/launchConfigurationGeneralInformation.png"><img alt="Launch Configuration (General)" src="../_images/launchConfigurationGeneralInformation.png" style="width: 800.0px; height: 225.0px;" /></a>
<p class="caption">起動構成 (一般情報)</p>
</div>
<ol class="arabic">
<li><p><strong>サーバー名テンプレート</strong></p>
<p>サーバー名テンプレートは起動構成に従って開始されているサーバーに適用される名前をコントロールします。
起動構成の一部として、サーバー名の命名には、2つのアプローチがあります。</p>
<p>最初のアプローチは、このフィールドに単にハードコードに値をつけることです。その意味は
層が多くのサーバーを含んでスケールすることがあれば、それらはすべて許可された同じ名前が付けられますが、
、それはいつも望ましいわけではありません</p>
<p>上記の図に示すように、2番目のアプローチは、パラメータを使用することです。利用できる
パラメータは次のとおりです。</p>
<ul class="simple">
<li>{tier} このサーバーが実行されている層の名前</li>
<li>{group} 後方互換性のために、現在のところ層名で解決されます。</li>
<li>{count} このサーバーのカウント（層の1からの連続番号）。</li>
<li>{role} クラスタノード、独立したノード、MASTER、レプリカント、STANDALONEのうちのどれか一つ：
（文字列を小文字に変換する）</li>
<li>{type} 負荷、サービス、クラスタデータベース、複製データベース、UNKNOWNのいずれか：
（文字列を小文字に変換）</li>
<li>{zone} サーバが動作しているプロバイダのゾーンID。</li>
<li>{dc} 上記のゾーンと同じように解決します。</li>
<li>{region} サーバが動作しているプロバイダのリージョンID。</li>
<li>{ip} サーバの予約済みアドレス（パブリックIP）。</li>
<li>{year} サーバの起動時刻の年。</li>
<li>{day} サーバの起動時刻の日。</li>
<li>{hour} サーバの起動時刻の時間。</li>
<li>{minute} サーバの起動時刻の分。</li>
</ul>
<p>このアプローチはサーバーに一意の名前を付けるという、サーバーがインテリジェントな方法で[層に参加する/層から去る]利点があります。</p>
</li>
<li><p class="first"><strong>Recovery Point</strong></p>
<p>リカバリポイントのパラメータはenStratusが失敗したサーバの回復イベントを開始するまでの待機時間を設定します。
サーバーは、エージェントに到達できない、サーバにピングできない、またはサーバーが完全に停止した場合は失敗したと
想定し、もはやはmin/ maxに数えません。</p>
</li>
<li><p class="first"><strong>Use Encryption</strong></p>
<p>この設定は、サーバーに接続されたボリュームが暗号化されているかどうかを決定します。このオプションは、
現在Linuxの統一キーセットアップを採用することができるLinuxベースのサーバでのみ意義があります。
このタイプの暗号化は、ファイルシステムベースの暗号化です。</p>
</li>
<li><p class="first"><strong>Server Type</strong></p>
<p>サーバータイプには5つのオプションがあります。</p>
<ul class="simple">
<li>ロードバランサ。このオプションは、この層内のサーバーのロード·バランサとして起動設定を指定します。</li>
<li>サービス全般サービス。このオプションは、起動構成でWebアプリケーションなどの汎用サービスとして構成された
サーバとして識別されています。</li>
<li>クラスタ化データベース。クラスタ化データベースは、レプリケーションを使用していないデータベースで、
独立したエンティティとして扱われます。</li>
<li>レプリケーティドデータベース。レプリケーティドデータベースはレプリケーションを実行するように設定されているデータベースです。</li>
<li>未知のサービス。これは汎用のサービスへのエントリです。</li>
</ul>
</li>
<li><p class="first"><strong>Snapshot Frequency</strong></p>
<p>このパラメータは、enStratusが、自動的に接続されたボリュームのスナップショットを実行する頻度を設定します。
層の一部として複数のサーバが実行されており、それぞれ独自のボリュームが接続されているかもしれませんが
enStratusは、そのうちの一つのボリュームだけのスナップショットをとることに注意してください。</p>
<p>これは重要なアーキテクチャの配慮を強調しています。層で実行されている各サーバは
同一である必要があり、接続されたボリュームも同様です。サーバ間のアーキテクチャにバリエーションが
求められるとすれば、それは追加の層を構成するかどうかです。</p>
<p>低すぎるスナップショットの頻度を設定しないように注意してください。スナップショットが完了するまで
ファイルシステムをロックします。それはアプリケーションのパフォーマンスに影響を与えることがあります。
また、ほとんどのクラウドプロバイダは、保存することができるスナップショットの数を制限し、設定頻度が高い
場合、この制限はエラーになる場合があります。通常、ほとんどのアプリケーションの場合一日あたり、
1つのスナップショットで十分です。</p>
</li>
</ol>
<div class="section" id="id18">
<h3>4.8.1. マシン　イメージ<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/launchConfigurationMachineImage.png"><img alt="Launch Configuration Machine Images" src="../_images/launchConfigurationMachineImage.png" style="width: 950.0px; height: 250.0px;" /></a>
<p class="caption">Launch Configuration Machine Images</p>
</div>
<ol class="arabic">
<li><p class="first"><strong>Primary Machine Image</strong></p>
<p>プライマリマシンイメージはenStratusが層でサーバを開始するために使用するマシン·イメージを指定します。</p>
</li>
<li><p class="first"><strong>Primary Product</strong></p>
<p>cloud provider you will see other options present here.
プライマリプロダクトは非常にクラウド固有のものでオプションのリストが含まれています。この図は
AWS EC2プロバイダ固有のオプションを示しています。別のクラウド·プロバイダーを使用している場合
、これとは別のオプションが表示されます。</p>
</li>
<li><p class="first"><strong>Secondary Machine Image</strong></p>
<p>セカンダリマシンイメージは、enStratusが、その定義から後続のサーバーを起動するために使用する
固有の定義オプションを持ったマシンイメージです。</p>
<p>セカンダリマシンイメージを使用する最も論理的な実装の例はレプリケーティドデータベースです。
enStratusによってプライマリマシンのイメージが使用されてマスターデータベースが起動し、
後続のすべてのサーバが、セカンダリマシンイメージを使用してスレーブとして機能します。</p>
</li>
<li><p class="first"><strong>Secondary Product</strong></p>
<p>セカンダリプロダクトは、プライマリプロダクトと同じようにでプロビジョニングされた仮想ハードウェアの量を定義します。</p>
</li>
</ol>
</div>
<div class="section" id="id19">
<h3>4.8.2. ボリューム<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ボリュームのオプションはクラウド　プロバイダーがブロック　ストレージを備えている場合にのみ存在します。</p>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/launchConfigurationVolumes.png"><img alt="Launch Configuration, Volumes" src="../_images/launchConfigurationVolumes.png" style="width: 960.0px; height: 160.0px;" /></a>
<p class="caption">Launch Configuration, Volumes</p>
</div>
<p>ボリュームの仕様は、層内でサーバーに接続されるボリュームの数とサイズを決定します。
これらのボリュームの暗号化オプションが一般的な構成の一部として指定されます。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/launchConfigurationFirewalls.png"><img alt="Launch Configuration, Firewalls" src="../_images/launchConfigurationFirewalls.png" style="width: 960.0px; height: 160.0px;" /></a>
<p class="caption">Launch Configuration, Firewalls</p>
</div>
<p>ファイアウォールの定義は、その中でサーバーが開始されるファイアウォールを指定します。</p>
</div>
<div class="section" id="id20">
<h3>4.8.3. サーバーの管理、サーバー<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>このタブを選択すると、選択した起動構成の一部として実行しているサーバーが表示されます。</p>
</div>
</div>
<div class="section" id="id21">
<h2>4.9. 層<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<p>層は、実行中のサーバーを含む論理的かつ物理的にスケーラブルな部門です。層は
1つまたは複数のクラウドに跨る可能性がありますので、それは、プライベート　データセンターに
プロビジョニングしてサーバーを開始することもあり、需要によっては追加のインフラストラクチャを
パブリック　クラウド　プロバイダーに爆発的に拡大することも可能です。。</p>
<p>起動設定は、層内に論理的に含まれています。実際には、対応する起動設定なしにはどのリージョンにも存在することはできません。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/tierHighlighted.png"><img alt="Tier" src="../_images/tierHighlighted.png" style="width: 200.0px; height: 200.0px;" /></a>
<p class="caption">Tier</p>
</div>
<div class="section" id="id22">
<h3>4.9.1. 層の管理、一般情報<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/tierGeneralInformation.png"><img alt="Tier, General" src="../_images/tierGeneralInformation.png" style="width: 600.0px; height: 250.0px;" /></a>
<p class="caption">Tier, General Information</p>
</div>
<p>層の管理には層を削除する機能と層に対するシェルアクセスを認める機能が含まれています。
層が削除された場合、すべての関連した起動設定も削除されます。
シェルアクセスオプションが選択された場合は、管理者に層で実行されているサーバーへのシェルアクセスを
追加するためのダイアログボックスが表示されます。</p>
</div>
<div class="section" id="id23">
<h3>4.9.2. 層の管理、シェルアクセス<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/tierShellAccess.png"><img alt="Tier, Shell Access" src="../_images/tierShellAccess.png" style="width: 500.0px; height: 150.0px;" /></a>
<p class="caption">Tier, Shell Access</p>
</div>
<p>サーバが継続中な層の操作の一部として開始されている場合、シェルに指定されたユーザーは
サーバがnStratusプロビジョニングサーバで登録された直後にシェルアクセスを許可されます。</p>
<p>シェルアクセスのためには個々のサーバで同じ要件、すなわちファイアウォールはSSHが実行されているポート上で開いておく必要があり、
ユーザーは自分のプロファイルの一部としてパブリックキーを持っている必要があります。</p>
</div>
<div class="section" id="id24">
<h3>4.9.3. 層のスケーリング　ルール、スケーリング　ルール<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/tierScalingRules.png"><img alt="Tier, Scaling Rules" src="../_images/tierScalingRules.png" style="width: 650.0px; height: 350.0px;" /></a>
<p class="caption">Tier, Scaling Rules</p>
</div>
<p>スケーリングルールには、層のリソースのスケーリングを管理するパラメータが存在します。</p>
<ol class="arabic">
<li><p class="first"><strong>Minimum Servers</strong></p>
<p>最小サーバー数は常時、層で実行され続けなければならないサーバーの最小必要数の仕様です。
もし層で実行中のサーバーの合計数がこのしきい値を下回ると、自動回復イベントがトリガされます。</p>
</li>
<li><p class="first"><strong>Maximum Servers</strong></p>
<p>最大サーバ数の仕様では、層が許容できるサーバーの最大数を設定します。
層に追加サーバーのリソース要求があれば、enStratusはスケールアップしますが、
この最大値を超えることはありません。</p>
</li>
<li><p class="first"><strong>Scaling Rules</strong></p>
</li>
</ol>
<p>スケーリングルールには3つのオプションがあります。</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first"><strong>enStratus</strong></p>
<p>enStratusのスケーリングオプションはデフォルトで示すものです。スケーリングの動作では、
ここで説明する特定の &#8220;ハードウェア&#8221;パラメータによって管理されます。。</p>
<p>enStratusは、サーバーのCPU負荷を監視することにより、スケーリングイベントを管理できます。CPU
負荷は [15分間の平均負荷 / CPUの数] です。：たとえば、システムが2つのCPUを持っていて、
負荷の平均が0.89である場合、CPUしきい値の読み取りは、 0.445*100 = 44.5です。</p>
<ul>
<li><p class="first">Lower CPU Threshold.</p>
<p>CPUの下限しきい値。このレベルを下回ってしきい値が低下して、かつ
実行中のサーバー数が最小サーバー数よりも多くあるときは、サーバーは、需要減少のために終了されます。</p>
</li>
<li><p class="first">Upper CPU Threshold</p>
<p>CPUの上限しきい値。このレベルを超えてしきい値が上昇して、かつ
実行中のサーバー数が最大最大数より少ない場合、サーバは需要増加を満たすために開始されます。</p>
</li>
<li><p class="first">Lower RAM Threshold</p>
<p>RAMの下限しきい値。これはRAMの使用量の下限をパーセントで設定します。
このレベルを下回ってしきい値が低下して、かつ実行中のサーバー数が最小サーバー数よりも多くあるときは、
実行中のサーバは、需要減によってスケールダウンされます。</p>
</li>
<li><p class="first">Upper RAM Threshold</p>
<p>be scaled up due to increased demand.
RAMの上限しきい値。これはRAMの使用量の上限をパーセントで設定します。
このレベルを上回ってしきい値が上がり、かつスケールアップする余裕が有るとき、
サーバは、需要増によってスケールアップされます。</p>
</li>
</ul>
</li>
<li><p class="first"><strong>Cloud</strong></p>
<p>enStratusまた、クラウドプロバイダのプロパティに基づいてスケーリングイベントをトリガすることができます。
クラウドプロバイダーが、スケーリングを支配するための適したメカニズムを持っている場合は、クラウドオプションが
クラウドオプションが選択されていれば、enStratusはそれを延期します。</p>
</li>
<li><p class="first"><strong>Custom</strong></p>
<p>カスタムスケーリングルールは、スケールイベントを制御するための圧倒的に最も強力な方法です。
実際のCPUやCPU負荷が共有されるマルチテナントクラウド環境で作業する際に、
本当に意味のあるコンセプトでCPU負荷を読むことにデフォルトでは固有の問題があります。</p>
<p>端的に言うと、enStratusのカスタムスケールとは約30秒の間にenStratusが/enstratus/bin/scaleCheckと呼ばれる
スクリプトの出力を読み込むことを意味します。enStratusのスケーリング動作を制御するscaleCheckスクリプトは
enStratusに信号を送ります。その信号は [スケールアップ、何もしない、またはスケールダウン] それぞれに対応して
、1、0、または-1を返します。</p>
<p>enStratusによってグループ内のサーバ数をスケーリングするかどうかを判断するたの投票機構が使用されます。
基本的に、もしサーバグループのサーバの大半が1を返すことによってスケールアップの &#8220;投票&#8221;をすれば、新規の
サーバーが開始されます。もしサーバグループのサーバの大半が-1を返すことによってスケールダウンの &#8220;投票&#8221;をすれば、
グループ内のランダムに選択されて終了します。ほとんどのサーバーが0に投票する場合、スケーリングは行われません。</p>
<p>ここにEC2で動作中の&#8221;small&#8221;サーバーに正規化係数を適用するメカニズムを提供するために書かれた
scaleCheckスクリプトの例があります。</p>
</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">すべてのケースで、enStratusは、スケールを主導するアクションを管理します。各
スケーリングイベントは、サーバーの起動であり、その周りの調整/自動化されたの全ての
起動はenStratusで設定したパラメータセットを使用して制御されています。</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="nv">stat</span><span class="o">=</span><span class="k">$(</span>uptime | awk <span class="s1">&#39;{print $12}&#39;</span> | sed <span class="s1">&#39;s/,//g&#39;</span><span class="k">)</span>
<span class="nb">time</span><span class="o">=</span><span class="k">$(</span> date +%H:%M:%S <span class="k">)</span>

<span class="nv">MAX_THRESHOLD</span><span class="o">=</span>0.75
<span class="nv">SCALE_FACTOR</span><span class="o">=</span>0.35

<span class="k">if</span> <span class="o">[</span> ! -e statFile <span class="o">]</span>;
        <span class="k">then </span>touch statFile
        cat &gt; statFile <span class="s">&lt;&lt; STOP_HERE</span>
<span class="s">MAX=1.00</span>
<span class="s">MIN=0.32</span>
<span class="s">STOP_HERE</span>
<span class="k">fi</span>

<span class="nv">SCALED_LOAD</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$stat</span> <span class="k">${</span><span class="nv">SCALE_FACTOR</span><span class="k">}</span>| awk <span class="s1">&#39;{print $1*$2}&#39;</span><span class="k">)</span>

<span class="c">#echo &quot;Actual Load: $stat&quot;</span>
<span class="c">#echo &quot;Scaled Load: $SCALED_LOAD&quot;</span>

<span class="nv">DO_SCALE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$SCALED_LOAD</span> <span class="nv">$MAX_THRESHOLD</span> | awk <span class="s1">&#39;{if ($1 &gt; $2) print &quot;1&quot;; else print &quot;0&quot;}&#39;</span><span class="k">)</span>

<span class="k">function </span>checkMax<span class="o">(){</span>
        <span class="nv">NEW_MAX</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$1</span> <span class="nv">$2</span> | awk <span class="s1">&#39;{if ($1 &gt; $2) print &quot;1&quot;; else print &quot;0&quot;}&#39;</span><span class="k">)</span>
        <span class="c">#echo &quot;Is this a new max: $NEW_MAX&quot;</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$NEW_MAX</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">                </span>sed -i <span class="s2">&quot;s/MAX=${2}/MAX=${1}/&quot;</span> statFile
        <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>checkMin<span class="o">(){</span>
        <span class="nv">NEW_MIN</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$1</span> <span class="nv">$2</span> | awk <span class="s1">&#39;{if ($1 &lt; $2) print &quot;1&quot;; else print &quot;0&quot;}&#39;</span><span class="k">)</span>
        <span class="c">#echo &quot;Is this a new min: $NEW_MIN&quot;</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$NEW_MIN</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">                </span>sed -i <span class="s2">&quot;s/MIN=${2}/MIN=${1}/&quot;</span> statFile
        <span class="k">fi</span>
<span class="o">}</span>

<span class="c">#echo &quot;Should we scale? $DO_SCALE&quot;</span>

<span class="nb">source </span>statFile

checkMax <span class="nv">$SCALED_LOAD</span> <span class="nv">$MAX</span>
checkMin <span class="nv">$SCALED_LOAD</span> <span class="nv">$MIN</span>

<span class="nb">echo</span> <span class="nv">$DO_SCALE</span>
</pre></div>
</div>
</div>
<div class="section" id="id25">
<h3>4.9.4. スケーリング感度<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p><strong>違反期間(Breach Period)</strong></p>
<p>スケーリングイベントが発生する前に負荷平均が、[CPUの上限しきい値]を超えるにちがいない時間の量のことで、
結果としてサーバが多いことになります。</p>
</li>
<li><p><strong>クールダウン期間(Cooldown Period)</strong></p>
<p>スケーリングイベントが発生する前に負荷平均が、[CPUの下限しきい値]を下回るにちがいない時間の量のことで、
結果としてサーバが少ないことになります。
違反とクールダウン期間は、スケーリング動作の &#8220;感度&#8221;を制御します。</p>
</li>
<li><p><strong>違反インクリメント(Breach Increment)</strong></p>
<p>違反インクリメントは、enStratusがスケールアップまたはダウンするのに使用する &#8220;step&#8221; のサイズ
を制御します。サーバの最小数と最大数の仕様はenStratusがスケールするときの部屋、enStratusが
違反インクリメントで指定されたサーバーの数でそれを行います。</p>
<p>例えば、最小値と最大値がそれぞれ2と10で、違反インクリメントが2であるときに、
追加リソースを必要とする需要があれば、最初のスケーリングアクションが発生し、4サーバーとなります。
スケールダウンするときにもスケールアップの時と同様の原理が適用されます。</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">enStratusスケーリングルールが所定の位置にあれば、enStratusは /mnt/tmp/stats.propertiesで
提示された値を読み取ります。これは /enstratus/bin/calculateAgentData スクリプトの産物です。</p>
</div>
</div>
<div class="section" id="id26">
<h3>4.9.5. サーバー管理、サーバー<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>このタブを選択すると、選択した層の一部として実行しているサーバーが表示されます。ビューでは
層のすべてのリージョンでサーバーリストを集めます。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/tierServers.png"><img alt="Tier, Servers" src="../_images/tierServers.png" style="width: 700.0px; height: 200.0px;" /></a>
<p class="caption">Tier, Servers</p>
</div>
</div>
<div class="section" id="id27">
<h3>4.9.6. サービス管理、サービス<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>ここからは、サービスと対話することが可能です。層にサービスを追加するには、図から層を選択します。
上記のサービス管理タブに移動してサービスの追加を選択します。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/addServiceToTier.png"><img alt="Tier, Add Service" src="../_images/addServiceToTier.png" style="width: 300.0px; height: 250.0px;" /></a>
<p class="caption">Tier, Add Service</p>
</div>
<p>利用可能なサービスのリストが表示されます。サービスの追加には、最小限の情報が必要です。
サービスのより興味深い部分は、構成です。</p>
<p>このオプションを選択すると、この層に接続されているサービスを紹介します。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/tierManageService.png"><img alt="Tier, Services" src="../_images/tierManageService.png" style="width: 700.0px; height: 200.0px;" /></a>
<p class="caption">Tier, Services</p>
</div>
<p>同じプロセスを使用して、サービスも、データベース層に追加されました。すべてのサービスを表示するには、
配備を選択し、[サービス管理]を選択します。すると配備上の層にインストールされているすべてのサービスが
コンソールに表示されます。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/allServices.png"><img alt="Tier, All Services" src="../_images/allServices.png" style="width: 700.0px; height: 200.0px;" /></a>
<p class="caption">Tier, All Services</p>
</div>
</div>
<div class="section" id="id28">
<h3>4.9.7. サービスの構成<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>サービスの構成は、サービスが着信トラフィック、資格情報、および依存関係をリッスンする時のポートなどの
オプションを制御します。サービスに関連付けられた構成オプションを表示するには、
サービスの緑色のアクションボタンをクリックしてください。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/serviceActions.png"><img alt="Service, Actions" src="../_images/serviceActions.png" style="width: 400.0px; height: 300.0px;" /></a>
<p class="caption">Service, Actions</p>
</div>
</div>
<div class="section" id="id29">
<h3>4.9.8. 起動<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>起動は、すでに実行中の配備上でサービスを開始するために予約されているオプションです。
サービスで、enStratusは /mnt/services/$serviceID/bin/enstratus-start と呼ばれるスクリプトを呼び出します。</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">配備が実行されていない場合、このアクションは無意味です。</p>
</div>
</div>
<div class="section" id="id30">
<h3>4.9.9. 編集<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/editService.png"><img alt="Service, Edit" src="../_images/editService.png" style="width: 400.0px; height: 300.0px;" /></a>
<p class="caption">Service, Edit</p>
</div>
<p>サービスの編集には、いくつかのオプションが表示されます。ここで提示されるオプションは、
enStratusが、サービスをどのように扱い、変化が発生した場合にどの情報をサービスに渡すかを制御します。</p>
<ol class="arabic" start="3">
<li><p><strong>バックアップの頻度</strong></p>
<p>バックアップ頻度の設定はenStratusが、 /mnt/services/$serviceID/enstratus/bin/enstratus-backupService に
ある任意のカスタムバックアップスクリプトを呼び出す頻度を制御します。
これは、サービス　レベルのバックアップであり、enStratusは、結果としてクラウドストレージに
バックアップファイルを保存します。</p>
</li>
<li><p><strong>構成</strong></p>
<p>構成は、管理者がサービスに渡す機密情報で、自由形式のテキストフィールドです。
この情報はスケーリング中とイベントの開始時に必要に応じて直接 enstratus.cfgファイルに
/mnt/services/$serviceID/bin/enstratus-configure への引数として渡されます。
enstratus.cfgファイルは、使用された後確実に消去されることに注意してください。</p>
</li>
<li><p>ユーザーとして実行</p>
<p>ユーザーとして実行では、ユーザーがenStratusを使用してサービスを開始するように制御するのに使用されます。</p>
</li>
<li><p>サービスイメージ</p>
<p>サービスイメージは、指定されたサービスのために使用されるサービスのイメージです。
サービスイメージは、最初に Automation &gt; Service Images を介してアップロードされる必要があります。</p>
</li>
<li><p>スケーリングモデル</p>
<p>スケーリングモデルでは、4つのオプションがあります。</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first"><strong>None</strong></p>
<p>このオプションは、通常のスケーリングのメカニズムを越えてスケーリングにとられる特別な
アクションは無いこと意味します</p>
</li>
<li><p class="first"><strong>Load Balanced</strong></p>
<p>このオプションは、enStratusがロード·バランサに何時、このサービスに影響を与えるスケーリングイベントを
発生させるかを通知するかを指示します。</p>
</li>
<li><p class="first"><strong>Replicated Database</strong></p>
<p>このオプションは、enStratusが層で最初に開始したサーバーをマスターとして、後続のすべてのサーバー
をスレーブとして扱うように指示します。このプロセスの詳細についてはMySQLサービスイメージを
参照してください。</p>
</li>
<li><p class="first"><strong>Clustered Database</strong></p>
<p>このオプションは、enStratusにすべてのデータベースサーバを
マスター/スレーブ関係の無いピアとして扱うように指示します。</p>
</li>
</ol>
</div></blockquote>
</li>
<li><p>SSL証明書</p>
<p>SSL証明書は、 Infrastructure &gt; SSL でのインターフェースを介してenStratusにアップロードすることができます。</p>
</li>
</ol>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/sslCertificate.png"><img alt="SSL, Add" src="../_images/sslCertificate.png" style="width: 400.0px; height: 300.0px;" /></a>
<p class="caption">SSL, Add</p>
</div>
<p>証明書がenStratusにアップロードされている場合は、オプションとして存在することとなり、
起動時に /enstratus/bin/configureService スクリプトを介して確実ににサーバに渡され、
そして最終的に、サービス構成に使用するためユーザー定義の /mnt/services/$serviceID/bin/enstratus-configure スクリプト
に渡されます。</p>
<p>このオプションでは、SSL証明書はアプリケーション·サーバーに渡されます。</p>
<ol class="arabic" start="7">
<li><p class="first"><strong>Load Balancer SSL</strong></p>
<p>このオプションをオンにすると、管理者はSSL証明書のターゲットとしてロードバランサを指定することができます。
このオプションは、仮想マシンベースのロードバランサでのみ使用可能です。</p>
<p>SSL証明書はクラウドベースのロードバランサにも利用できるかもしれませんが、すべてのクラウドが、
このオプションをサポートしているわけではないのでクラウド　プロバイダを介して構成する必要があります。</p>
</li>
<li><p class="first"><strong>Billing Code</strong></p>
<p>課金コードに対して層のコストを追跡することが可能です。同じ配備内の異なる層は
、異なる課金コードを持つことができます。</p>
</li>
<li><p class="first"><strong>Owning Group</strong></p>
<p>所有グループは、サービスのグループ属性を指定します。</p>
</li>
</ol>
</div>
<div class="section" id="id31">
<h3>4.9.10. ポート<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/servicePorts.png"><img alt="Service, Ports" src="../_images/servicePorts.png" style="width: 400.0px; height: 200.0px;" /></a>
<p class="caption">Service, Ports</p>
</div>
<p>サービスにサービスポートを追加すると、該当するポートに enstratus.cfg ファイルを介してサービスへの
情報を渡すようにenStratusを設定します。配備に接続されているロードバランサがある場合、
それはロードバランサの選択ウィンドウに表示されます。ロードバランサが選択されるとenStratusは、
確実にスタート時にそのサービスをインストールされたサーバーをロードバランサーに接続します。</p>
<p>より具体的には、もし仮想マシンベースのロードバランサが指定されていて、アプリケーションサーバーに、
ロードバランサに接続されているサービスがインストールされている場合、enStratusは、サービスが
プリケーション·サーバー上で構成された後にロードバランサ上の /enstratus/bin/startProxy を呼び出します。</p>
<p>elastic load balancer （ELB）のようなクラウドベースのロードバランサの場合、enStratusは
ELBにそのサーバーを接続する正しいAPIのコマンドを呼び出します。クラウドベースのロードバランサ
は、あらかじめ適切なポートとプロトコル上でトラフィックを渡されるように設定されている必要があります。</p>
<p>ポートの enstratus.cfg ファイルの関連セクションはここに示されています：</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>enstratus<span class="o">]</span>
port.80.protocol<span class="o">=</span>TCP
port.80.publicPort<span class="o">=</span>80
port.80.privatePort<span class="o">=</span>80
</pre></div>
</div>
<p>資格証明も確実に enstratus.cfg ファイルを介してサービスに配備の開始時に渡されます。これらの資格証明に
何が起こるかはアプリケーション/サービスのアーキテクトによって書かれたはずの enstratus-configure スクリプト
アクションによって決まります。</p>
</div>
<div class="section" id="id32">
<h3>4.9.11. 資格証明<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>資格証明も確実に enstratus.cfg ファイルを介してサービスに配備の開始時に渡されます。これらの資格証明に
何が起こるかはアプリケーション/サービスのアーキテクトによって書かれたはずの enstratus-configure スクリプト
アクションによって決まります。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/serviceCredentials.png"><img alt="Service, Credentials" src="../_images/serviceCredentials.png" style="width: 350.0px; height: 300.0px;" /></a>
<p class="caption">Service, Credentials</p>
</div>
<p>資格情報　enstratus.cfg　ファイルの関連セクションはここです。：</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>enstratus<span class="o">]</span>
<span class="nv">serviceKeys</span><span class="o">=</span>admin
serviceKey.admin.user<span class="o">=</span>adminUser
serviceKey.admin.password<span class="o">=</span>trustno1
</pre></div>
</div>
<p>この設定オプションは、enstratus.cfg ファイルを経由してサービスに渡される情報を制御します。
この情報がどうなるかはアプリケーションアーキテクトによって書かれた enstratus-configure スクリプト
で指定されたアクションによって決まります。</p>
</div>
<div class="section" id="id33">
<h3>4.9.12. データソース<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/serviceDataSources.png"><img alt="Service, Data Soruce" src="../_images/serviceDataSources.png" style="width: 400.0px; height: 200.0px;" /></a>
<p class="caption">Service, Data Soruce</p>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/serviceEditDataSource.png"><img alt="Data Source, Edit" src="../_images/serviceEditDataSource.png" style="width: 400.0px; height: 300.0px;" /></a>
<p class="caption">Data Source, Edit</p>
</div>
<p>データソースは、データベースサービスにのみ接続されています。データソースは、配備で使用する
ためにenStratusに Automation &gt; Data Sources のwebインターフェースを経由してアップロード
された datasource.sql のようなデータベースのバックアップファイルです。</p>
<p>上の図は、MySQLサービスのデータソースの構成を表示しています。利用できる
データソースとその機能の構成オプションが、ここで説明されています。</p>
<ol class="arabic">
<li><p class="first"><strong>Name</strong></p>
<p>名前は、enStratusコンソールに表示されますように、データソースの論理名です。</p>
</li>
<li><p class="first"><strong>Name in Database</strong></p>
<p>この設定オプションは、最終的にMySQLサービスの場合のように、データベース自体の名前になります。</p>
</li>
<li><p class="first"><strong>Description</strong></p>
<p>人が参照サービスに使用する説明テキスト。</p>
</li>
<li><p class="first"><strong>Label</strong></p>
<p>enStratusコンソールのサービスに任意のカラーコードを適用できます。</p>
</li>
<li><p class="first"><strong>Service User</strong></p>
<p>サービスユーザは、サービスを所有するサーバ上のユーザとなります。</p>
</li>
<li><p class="first"><strong>Backup Frequency</strong></p>
<p>この設定オプションは、enStratusが、 /enstratus/bin/backupService と呼ばれるエージェントスクリプトを呼び出す
頻度を指定します。このスクリプトの機能はユーザが
設定した /mnt/services/$serviceID/bin/enstratus-backupDataSourceと呼ばれるスクリプト呼び出すことです。
このスクリプトが存在する場合、enStratusはそれを実行し、クラウドストレージに結果のファイルを配置します。
そうでない場合は、これは動作不能なイベントです。</p>
</li>
<li><p class="first"><strong>Service Password</strong></p>
<p>このパラメータは、データソースへの接続に使用することができるパスワードになります</p>
</li>
<li><p class="first"><strong>Custom Configuration</strong></p>
<p>カスタム構成オプションはサービスの構成時に enstratus-configure スクリプトに情報を渡すために使用する
ことができる、自由形式のテキストフィールドです。この情報は enstratus.cfg ファイル内に格納されます。</p>
</li>
<li><p class="first"><strong>Data Source Image</strong></p>
<p>データソースイメージは、データベースフィールドでの名前のデータベース ダンプファイルで初期化時に使用されます。
。</p>
</li>
<li><p class="first"><strong>Owning Group</strong></p>
<p>役割ベースのアクセスコントロールが使用されている場合は、所有グループは、サービスに割り当てることができます。</p>
</li>
</ol>
</div>
<div class="section" id="dependencies">
<h3>4.9.13. Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/serviceDependencies.png"><img alt="Service, Dependencies" src="../_images/serviceDependencies.png" style="width: 500.0px; height: 150.0px;" /></a>
<p class="caption">Service, Dependencies</p>
</div>
<p>Creating an dependency means establishing a logical connection between services. For
example, an application service may have a dependency on a database service. Perhaps even
more meaningful than that, an application service may have a dependency on a database data
source.</p>
<p>Operationally, if there exists a dependency between two services, when there are changes
that affect either service such as an auto-recovery or an auto-scaling event, the other
service is notified by enStratus of this environmental change.</p>
<p>This notification process is conducted using the enstratus.cfg file which is passed to all
affected services in a tier.</p>
<p>In the figure above, an application service has a dependency on a data source installed on
a database service. If there is an auto-recovery event on a database server housing the
data source, the application services that depend on it will be notified when enStratus
passes in a new enstratus.cfg file to each of them.</p>
<p>Similarly, when changes such as an auto-recovery or an auto-scaling event occur on servers
housing the application service, the database service will be notified as well to grant or
revoke database access as necessary to compensate for changes at the application tier.
The takeaway message for dependencies is that dependencies establish logical relationships
between services that ensure the required information is passed when environment
changes occur such as a scale or recovery of a server that is running an affected service.</p>
</div>
<div class="section" id="delete">
<h3>4.9.14. Delete<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h3>
<p>Deleting a service will remove it from a tier.</p>
</div>
<div class="section" id="versioning">
<h3>4.9.15. Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h3>
<p>Maintaining the most recent version of a service is dependent somewhat on the cloud
provider. If your cloud provider has a concept of attachable block storage devices and
your services are installed upon one of them that is regularly being snapshotted, it may
be acceptable to rely on this mechanism for maintaing the most recent software. Update
your services on the running volumes, and the updates will persist once the next snapshot
is taken.</p>
<p>This approach is dependent upon the enStratus auto-recovery and scaling procedures. It is
advisable to also update the service images that are defined for each service in a tier by
uploading a new service image via Infrastructure &gt; Service Images and then pointing the
service definition to the newest version.</p>
<p>If your cloud provider has no concept of attachable block storage devices, the only option
is to take the approach of uploading the new, updated service image via Infrastructure &gt;
Service images and then pointing the service definition to the newest version.</p>
</div>
</div>
<div class="section" id="ssl">
<h2>4.10. SSL<a class="headerlink" href="#ssl" title="Permalink to this headline">¶</a></h2>
<p>SSL certificates may be uploaded to enStratus where they will be protected via the same
encryption methods as any credentials for the customer account. SSL certificates should
not be imaged onto servers, rather, they should be installed in an automated on-demand
fashion at the time of server start.</p>
<div class="section" id="creating">
<h3>4.10.1. Creating<a class="headerlink" href="#creating" title="Permalink to this headline">¶</a></h3>
<p>Create SSL certificates by any method you desire. enStratus will inform the administrator
via an alert when the SSL cerfiticate is set to expire via a message of the form:</p>
<div class="highlight-python"><pre>New Cloud Event: Tue 07 Nov 2010 12:28:59 UTC
Cloud: Rackspace
Account: enStratus RS NOC
Subject: NEW EVENT #315741 (Severity 3) - SSL Certificate 'My CERT' EXPIRING: Sun Dec 12
00:00:00 UTC 2010

Customer ID: 9999
Customer: enStratus
Address: www.company.org
Expiration: Sun Dec 12 00:00:00 UTC 2010

The SSL certificate MPLS attached to www.company.org will soon expire.


If you need assistance understanding this message or if you believe this message is the
result of an issue with enStratus, please visit our support site at
https://support.enstratus.com and login with your standard enStratus login credentials.

To check on the status of enStratus itself, visit: http://status.enstratus.com

Subscribe to live status updates via RSS at http://status.enstratus.com/status.xml or via
Twitter at http://www.twitter.com/enStratusStatus.
</pre>
</div>
</div>
<div class="section" id="uploading">
<h3>4.10.2. Uploading<a class="headerlink" href="#uploading" title="Permalink to this headline">¶</a></h3>
<p>To upload your certificate to enStratus, navigate to Infrastructure &gt; SSL Certificates as
shown:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/sslCertificate.png"><img alt="SSL, Upload" src="../_images/sslCertificate.png" style="width: 400.0px; height: 250.0px;" /></a>
<p class="caption">SSL, Upload</p>
</div>
</div>
<div class="section" id="updating">
<h3>4.10.3. Updating<a class="headerlink" href="#updating" title="Permalink to this headline">¶</a></h3>
<p>To update your SSL certificate, choose an existing certificate from the list and update
the necessary fields, then save.</p>
</div>
<div class="section" id="using">
<h3>4.10.4. Using<a class="headerlink" href="#using" title="Permalink to this headline">¶</a></h3>
<p>Data sources are used when configuring a service. More is said about this in the section
on Tiers, which hold services.</p>
</div>
</div>
<div class="section" id="backups">
<h2>4.11. Backups<a class="headerlink" href="#backups" title="Permalink to this headline">¶</a></h2>
<p>Backups occur according the the parameters specified in the Launch Configuration
configuration. As snapshots and occur, they are tracked in the Automation &gt; Backups part
of the enStratus console.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/deploymentBackups.png"><img alt="Deployment Backups" src="../_images/deploymentBackups.png" style="width: 700.0px; height: 250.0px;" /></a>
<p class="caption">Deployment Backups</p>
</div>
</div>
</div>


          </div> 
        </div>
      </div>
    <div class="footer">
    <p>
      &copy; Copyright 2012, enStratus Networks Inc..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
	</p>
    </div>
      <div class="clearer"></div>
    </div>
	<div id="breadcrumbs">
		4. 配備構成
		</ul>
	</div>
	<script type="text/javascript" charset="utf-8" src="../_static/toc.js"></script>
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30212947-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
  </body>
</html>